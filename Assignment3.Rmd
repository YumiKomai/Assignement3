---
title: "Assignment3"
output: pdf_document
bibliography: bibliography.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(WDI)
library(ggplot2)
library(bibtex)
library(rvest)
library(dplyr)
library(xml2)
library(stringr)
```

## Research Quetion
Twenty years since the end of Apartheid: Did the collapse of Apartheid play a significant role in reducing racial and social inequality in South Africa? Is post-apartheid South Africa better off or worse off than during the apartheid era?

## Definition of Racial and social inequality
Before conducting the data analysis to find the answer for our research question, we begin by clarifying the definitions for racial and social inequality. While social ineuqality broadly refers to the existence of unequal opportunities for different social status/positions within a society, racial inequality can be seen as one of dimentions of social inequality. It thus indicates the discrimination based on race in access to socioeconomic opportunities or services. In our research study, we will specifically look into racial discrimination in terms of employment, education, and income levels. Becasue these three indicators within the capitalism society can be seen as fundamental yet significant estimators for the quality of human well-being, we decided to include them. In addition, we will try to identify drivers of unequal income distribution by controlling possible factors and variables such as unemployment rate and education level.

## Literature review
Before starting investigation, we need to look around previous researches which has been writen by various ambitious researchers.

According to Leibbrandt,(see @Leibbrandt)
  1, Since the fall of Apartheid(1993~2008), overall (include all races) income inequality increased. The same is true among four major racial groups.
  2, However, the major driver of inequality increase is intra-African inequality in South-Africa.

The reason why we choose this article as the first reference article for this article is that this is the most cited work in the South-African Inequality Study.

## Data Gathering

According to Leibbrandt, inequality has been increased since the fall of Apartheid. We will test this assumption by using other data which is not used in the article.

We found the data of monthly earnings among races and gender. We tried to scraping the data from the website.

```{r}
URL <- 'http://businesstech.co.za/news/wealth/131524/this-is-the-average-salary-in-south-africa-by-race-and-industry/'

RaceEarningsTable <- URL %>% read_html() %>%
                    html_nodes('#container > div.content_holder > div.content > div.post_single > div.post_content > div:nth-child(11) > table') %>%
                    html_table() %>% 
                    as.data.frame
RaceEarningsTable

URL <- 'http://businesstech.co.za/news/wealth/131524/this-is-the-average-salary-in-south-africa-by-race-and-industry/'

GenderEarningsTable <- URL %>% read_html() %>%
                    html_nodes('#container > div.content_holder > div.content > div.post_single > div.post_content > div:nth-child(13) > table') %>%
                    html_table() %>% 
                    as.data.frame
GenderEarningsTable

```

## Data Cleaning and Merging
In this section, we will try to clean the data so that they can be statistical analysed.

Firstly, we use command "summary" to investigate the structure (class of variables, number of vectors) of data frames we got in the previous section.
```{r}
summary(RaceEarningsTable)
summary(GenderEarningsTable)
```

As shown, every variables has a class of "characters" even though it represents numerical data.

The data we want to have is the mean of earnings among races and gender in 2003, 2012. 

Firstly, we make TimeVector and IndivisualVector to labeling the data.

```{r}
TimeVector <- c(2003,2012) #numerical vector
IndivisualVector <- c("Male","Female","White","Asian/Indian","Coloured","BlackAfrican") #character vector
```

Then, we try to convert character vector to numerical vector.

```{r}
male2003 <- as.numeric(gsub("([0-9]+).*$", "\\1", str_replace_all(GenderEarningsTable$X5[3], fixed(" "), "")))
is.numeric(male2003)
male2003
```
As I shown above, the character variable successfully converted to numerical variable.
Then, we make function which conduct this sequence.

```{r}
Converter <- function(x){
y <- as.numeric(gsub("([0-9]+).*$", "\\1", str_replace_all(x, fixed(" "), "")))
return(y)
}
test <- Converter(x = GenderEarningsTable$X5[3])
is.numeric(test)
test
```

Then, we can apply this function to all data.

```{r}
#definition of vector
Earnings2003 <- c(0,0,0,0,0,0)
Earnings2012 <- c(0,0,0,0,0,0)

#GenderEarnings
for(i in 3:4){
  Earnings2003[i-2] = Converter(x = GenderEarningsTable$X5[i])
  Earnings2012[i-2] = Converter(x = GenderEarningsTable$X6[i])
}
#RaceEarnings
for(i in 3:6){
  Earnings2003[i] = Converter(x = RaceEarningsTable$X5[i])
  Earnings2012[i] = Converter(x = RaceEarningsTable$X6[i])
}
Earnings2003
Earnings2012
preEarnings <- data.frame(IndivisualVector,Earnings2003, Earnings2012)
preEarnings
```

The preEarnings is messy data.

So we are going to transform it into tidy data.

```{r}
library(tidyr)
Earnings <- gather(preEarnings, time, mean, Earnings2003:Earnings2012)
Earnings
```

We suceeded to make the numerical vector showing the earnings among races and genders.

## Conduct basic descriptive statistics
The data we gathered in previous section partialy statisticaly analysed (mean and median are already calcurated). In this section, we try to figure out the trend of inequality graphycally by using descriptive statistics.




## Briefly discribing

# References